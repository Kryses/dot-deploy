#!/usr/bin/bash
set -e

DOTFILES_DIR="$HOME/.dotfiles"
SSH_DIR="$HOME/.ssh"
echo $DOTFILES_DIR
echo $SSH_DIR

disto=$(cat /etc/os-release | grep ID_LIKE | sed s/ID_LIKE=//g)

if ! [ -x "$(command -v ansible)" ]; then
  if [[ $disto == 'debian']]; then
	  sudo apt install -y  ansible
  elif [[ $disto == 'arch' ]]; then
    pacman -Sy ansible
  fi
fi

if [[ -f "$DOTFILE_DIR/ansible/roles/requirements.yml" ]]; then
	cd "$DOTFILES_DIR/ansible/roles"
	ansible-galaxy install -r requirements.yml
fi

cd "$DOTFILES_DIR"
ansible-playbook --ask-vault-pass --diff "$DOTFILES_DIR/ansible/main.yml" --ask-become-pass
